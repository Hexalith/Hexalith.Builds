name: 'Publish NuGet Packages'
description: 'Publish release packages to NuGet.org or preview packages to Github Packages'

permissions:
  packages: write
  contents: read

inputs:
  version:
    description: 'Version number for the packages'
    required: true
  nuget-api-key:
    description: 'NuGet API Key for publishing to NuGet.org'
    required: true
  github-token:
    description: 'GitHub token for publishing to GitHub Packages'
    required: true
    default: ${{ secrets.GITHUB_TOKEN }}

runs:
  using: "composite"
  steps:
    - name: Publish preview version (${{ inputs.version }}) to GitHub Packages
      if: contains(inputs.version, '-')
      shell: bash
      run: |
        dotnet nuget push './src/**/*.nupkg' --api-key ${{ secrets.GITHUB_TOKEN }} --source https://nuget.pkg.github.com/Hexalith/index.json

    - name: Publish release version (${{ inputs.version }}) to NuGet
      if: "!contains(inputs.version, '-')"
      shell: bash
      run: |
        dotnet nuget push './src/**/*.nupkg' --api-key ${{ inputs.nuget-api-key }} --source https://api.nuget.org/v3/index.json --skip-duplicate
